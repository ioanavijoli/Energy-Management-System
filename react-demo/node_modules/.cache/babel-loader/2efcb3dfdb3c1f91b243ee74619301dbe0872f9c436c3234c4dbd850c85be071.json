{"ast":null,"code":"import _toConsumableArray from \"/home/ioana/Desktop/Energy Management System/react-demo/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _slicedToArray from \"/home/ioana/Desktop/Energy Management System/react-demo/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nvar _jsxFileName = \"/home/ioana/Desktop/Energy Management System/react-demo/src/client/user-notifications.js\",\n  _this = this,\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport SockJsClient from 'react-stomp';\nimport './user-notifications.css';\nvar SOCKET_URL = 'http://localhost:8281/websocket';\nvar UserNotifications = function UserNotifications() {\n  _s();\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    notifications = _useState2[0],\n    setNotifications = _useState2[1];\n  var _useState3 = useState(''),\n    _useState4 = _slicedToArray(_useState3, 2),\n    userId = _useState4[0],\n    setUserId = _useState4[1];\n  useEffect(function () {\n    getLoggedInUsername();\n  }, []);\n  var getLoggedInUsername = function getLoggedInUsername() {\n    fetch('http://localhost:8080/auth/username', {\n      method: 'GET',\n      headers: {\n        'Authorization': 'Bearer ' + localStorage.getItem('token')\n      }\n    }).then(function (response) {\n      return response.text();\n    }).then(function (username) {\n      console.info(\"Logged-in Username: \" + username);\n      getUserIdFromUsername(username);\n    }).catch(function (error) {\n      console.error('Error fetching logged-in username:', error);\n    });\n  };\n  var getUserIdFromUsername = function getUserIdFromUsername(username) {\n    fetch(\"http://localhost:8080/user/id?username=\".concat(username), {\n      method: 'GET',\n      headers: {\n        'Authorization': 'Bearer ' + localStorage.getItem('token')\n      }\n    }).then(function (response) {\n      return response.json();\n    }).then(function (data) {\n      setUserId(data); // Set the userId state\n      initializeWebSocket(data); // Pass userId to initializeWebSocket\n    }).catch(function (error) {\n      console.error('Error fetching userId:', error);\n    });\n  };\n  var initializeWebSocket = function initializeWebSocket(userId) {\n    var topic = \"/topic/message/\".concat(userId);\n    var onConnected = function onConnected() {\n      console.log('Connected!!');\n    };\n    var onMessageReceived = function onMessageReceived(msg) {\n      setNotifications(function (prevNotifications) {\n        return [].concat(_toConsumableArray(prevNotifications), [msg.message]);\n      });\n    };\n    return /*#__PURE__*/React.createElement(SockJsClient, {\n      url: SOCKET_URL,\n      topics: [topic],\n      onConnect: onConnected,\n      onDisconnect: function onDisconnect() {\n        return console.log('Disconnected!');\n      },\n      onMessage: function onMessage(msg) {\n        return onMessageReceived(msg);\n      },\n      debug: false,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 61,\n        columnNumber: 13\n      }\n    });\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"notifications\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 17\n    }\n  }, \"Notifications:\"), /*#__PURE__*/React.createElement(\"ul\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 17\n    }\n  }, notifications.map(function (notification, index) {\n    return /*#__PURE__*/React.createElement(\"li\", {\n      key: index,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 25\n      }\n    }, notification);\n  }))));\n};\n_s(UserNotifications, \"0TmytXdPf8v7ZZUM2m7xZOtVoCQ=\");\n_c = UserNotifications;\nexport default UserNotifications;\nvar _c;\n$RefreshReg$(_c, \"UserNotifications\");","map":{"version":3,"names":["React","useState","useEffect","SockJsClient","SOCKET_URL","UserNotifications","_s","_useState","_useState2","_slicedToArray","notifications","setNotifications","_useState3","_useState4","userId","setUserId","getLoggedInUsername","fetch","method","headers","localStorage","getItem","then","response","text","username","console","info","getUserIdFromUsername","catch","error","concat","json","data","initializeWebSocket","topic","onConnected","log","onMessageReceived","msg","prevNotifications","_toConsumableArray","message","createElement","url","topics","onConnect","onDisconnect","onMessage","debug","__self","_this","__source","fileName","_jsxFileName","lineNumber","columnNumber","className","map","notification","index","key","_c","$RefreshReg$"],"sources":["/home/ioana/Desktop/Energy Management System/react-demo/src/client/user-notifications.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport SockJsClient from 'react-stomp';\nimport './user-notifications.css';\n\nconst SOCKET_URL = 'http://localhost:8281/websocket';\n\nconst UserNotifications = () => {\n    const [notifications, setNotifications] = useState([]);\n    const [userId, setUserId] = useState('');\n\n    useEffect(() => {\n        getLoggedInUsername();\n    }, []);\n\n    const getLoggedInUsername = () => {\n        fetch('http://localhost:8080/auth/username', {\n            method: 'GET',\n            headers: {\n                'Authorization': 'Bearer ' + localStorage.getItem('token'),\n            },\n        })\n            .then((response) => response.text())\n            .then((username) => {\n                console.info(\"Logged-in Username: \" + username);\n                getUserIdFromUsername(username);\n            })\n            .catch((error) => {\n                console.error('Error fetching logged-in username:', error);\n            });\n    };\n\n    const getUserIdFromUsername = (username) => {\n        fetch(`http://localhost:8080/user/id?username=${username}`, {\n            method: 'GET',\n            headers: {\n                'Authorization': 'Bearer ' + localStorage.getItem('token'),\n            },\n        })\n            .then((response) => response.json())\n            .then((data) => {\n                setUserId(data); // Set the userId state\n                initializeWebSocket(data); // Pass userId to initializeWebSocket\n            })\n            .catch((error) => {\n                console.error('Error fetching userId:', error);\n            });\n    };\n\n    const initializeWebSocket = (userId) => {\n        const topic = `/topic/message/${userId}`;\n\n        const onConnected = () => {\n            console.log('Connected!!');\n        };\n\n        const onMessageReceived = (msg) => {\n            setNotifications(prevNotifications => [...prevNotifications, msg.message]);\n        };\n\n        return (\n            <SockJsClient\n                url={SOCKET_URL}\n                topics={[topic]}\n                onConnect={onConnected}\n                onDisconnect={() => console.log('Disconnected!')}\n                onMessage={(msg) => onMessageReceived(msg)}\n                debug={false}\n            />\n        );\n    };\n\n    return (\n        <div className=\"container\">\n            <div className=\"notifications\">\n                <h3>Notifications:</h3>\n                <ul>\n                    {notifications.map((notification, index) => (\n                        <li key={index}>{notification}</li>\n                    ))}\n                </ul>\n            </div>\n        </div>\n    );\n};\n\nexport default UserNotifications;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}